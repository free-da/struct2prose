{
  "title": "Logging",
  "sections": [
    {
      "heading": "Einleitung",
      "blocks": [
        {
          "block_type": "list",
          "content": [
            "Logging-Anpassungen zur Laufzeit vornehmen",
            "server.log",
            "Logger-Einstellung"
          ]
        },
        {
          "block_type": "paragraph",
          "content": "Auf allen S0FTW4RE-Instanzen wird das Logging durch die Datei wildfly/standalone/configuration/logback.xml konfiguriert.\nDie Logging-Konfigurationen sind auf allen Instanzen gleich, außer dass\nin TEST und DEMO ein Loglevel von \"INFO\" und auf PROD \"ERROR\"\neingestellt ist. Um eine Versionierung dieser Datei zu gewährleisten,\nwird diese Datei durch einen Symlink auf das S0FTW4RE-REPO bereitgestellt:"
        },
        {
          "block_type": "code",
          "content": "ln -s /opt/s0ftw4reweb/S0FTW4RE_REPO/s0ftw4re_configfiles/\n[\nPROD|DEMO|TEST\n]\n/logback.xml /opt/s0ftw4reweb/wildfly/standalone/logback.xml"
        },
        {
          "block_type": "paragraph",
          "content": "Jede\nKonfigurationsdatei soll AUSSCHLIEßLICH aus dem Repo verlinkt werden\nund auch nur dort bearbeitet und nach Bearbeitung wieder eingecheckt\nwerden. Es sollen KEINE Dateien aus dem Repo kopiert werden!"
        },
        {
          "block_type": "paragraph",
          "content": "Die logback.xml wird von S0FTW4RE ausgeliefert und folgende ORGA-spezifische Anpassungen werden vorgenommen:"
        }
      ]
    },
    {
      "heading": "Logging-Anpassungen zur Laufzeit vornehmen",
      "blocks": [
        {
          "block_type": "code",
          "content": "<!-- Zeile 2: regelmäßiges Scannen nach Veränderungen in der Datei -->\n<configuration\nscan=\n\"true\"\nscanPeriod=\n\"30 seconds\"\n>"
        },
        {
          "block_type": "paragraph",
          "content": "Indem\ndas Logging-Framework alle 30 Sekunden nach Veränderungen in der\nLogging-Konfiguration sucht, können Anpassungen im laufenden Betrieb\nohne Neustart vorgenommen werden."
        }
      ]
    },
    {
      "heading": "server.log Bearbeiten",
      "blocks": [
        {
          "block_type": "paragraph",
          "content": "Das eigentliche Logging wird in der Datei /opt/s0ftw4reweb/wildfly/standalone/log/server.log vorgenommen. Diese Datei soll täglich rotiert werden. Die Logs werden\n30 Tage aufbewahrt, und bis zu einem Gesamtvolumen von 30 GB."
        },
        {
          "block_type": "code",
          "content": "<!-- ab Z. 55 -->\n<!-- Definition des Appender für das Schreiben der Logdateien \"server.log\" -->\n<appender\nname=\n\"RequestLogAppender\"\nclass=\n\"ch.qos.logback.core.rolling.RollingFileAppender\"\n>\n<file>\n${JBOSS_HOME}/standalone/log/server.log\n</file>\n<rollingPolicy\nclass=\n\"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy\"\n>\n<!-- rollover daily -->\n<fileNamePattern>\n/opt/s0ftw4reweb/wildfly/standalone/log/server.%d{yyyy-MM-dd}.%i.txt\n</fileNamePattern>\n<!-- each file should be at most 100MB, keep 30 days worth of history, but at most 3GB -->\n<maxFileSize>\n100MB\n</maxFileSize>\n<maxHistory>\n30\n</maxHistory>\n<totalSizeCap>\n3GB\n</totalSizeCap>\n</rollingPolicy>\n<encoder>\n<pattern>\n%date - %logger:\\n [%level]: %message%n%xException\n</pattern>\n</encoder>\n</appender>"
        },
        {
          "block_type": "paragraph",
          "content": "Zu\nBeachten, falls Konfigurationen kopiert werden: Der Name des Appenders\n\"RequestLogAppender\" muss zwingend erhalten werden, sonst weiß die\nAnwendung nicht, wo die zu loggenden Daten hingeschickt werden müssen."
        },
        {
          "block_type": "paragraph",
          "content": "Hier eine Erklärung der Einstellungen:"
        },
        {
          "block_type": "table",
          "content": [
            [
              "Element-Name",
              "Erläuterung des Wert"
            ],
            [
              "file",
              "die zu konfigurierende Log-Datei"
            ],
            [
              "rollingPolicy",
              "durch welche Regel ist die Log-Rotation festgelegt? hier: SizeAndTimeBasedRollingPolicy , also eine Rotation basierend auf verstreichender Zeit (täglich) und Größe (maxFileSize, hier: 100MB)"
            ],
            [
              "fileNamePattern",
              "der\n Ausgabeort der rotierten Log-Datei. Hier: am gleichen Ort wie das \nOriginal, mit dem Datums- und Nummerierungs-Suffix. Die Operatoren %d \n(date) und %i (Nummerierung) sind zwingend notwendig für die Verwendung der SizeAndTimeBasedRollingPolicy. Hier wird ein Benennungsschema von bspw. server.2024-01-04.0.txt erreicht."
            ],
            [
              "maxFileSize",
              "die maximale Größe einer Datei, bevor sie rotiert wird"
            ],
            [
              "maxHistory",
              "die maximale Anzahl an aufbewahrten Logging-Dateien"
            ],
            [
              "totalSizeCap",
              "das Gesamtvolumen an aufbewahrten Logging-Dateien"
            ],
            [
              "pattern",
              "das Layout, in dem die Log-Nachrichten in die Logdatei geschrieben werden"
            ]
          ]
        }
      ]
    },
    {
      "heading": "Logger-Einstellung Bearbeiten",
      "blocks": [
        {
          "block_type": "paragraph",
          "content": "Im letzten Teil der logback.xml werden die verwendeten Logger eingebunden und deren Loglevel festgelegt:"
        },
        {
          "block_type": "code",
          "content": "<!-- Z. 82 -->\n<logger\nname=\n\"de.s0ftw4re.system.ui.component.demo\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"org.apache.cxf.services\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"de.s0ftw4re.system.ui\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"de.s0ftw4re.system.jpql\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"org.hibernate\"\nlevel=\n\"INFO\"\n></logger>\n<!-- <logger name=\"org.hibernate.SQL\" level=\"INFO\" ></logger> -->\n<!-- <logger name=\"org.jboss.as.ee\" level=\"INFO\"></logger> -->\n<!-- <logger name=\"org.hibernate\" level=\"INFO\"></logger> -->\n<!-- <logger name=\"org.jboss.jca\" level=\"INFO\"></logger> -->\n<!-- <logger name=\"com.arjuna\" level=\"INFO\"></logger> -->\n<!-- <logger name=\"de.s0ftw4re.system.jpql\" level=\"INFO\"></logger> -->\n<logger\nname=\n\"de.s0ftw4re.system.attach\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"de.s0ftw4re.system.service\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"org.springframework.orm\"\nlevel=\n\"INFO\"\n></logger>\n<!-- <logger name=\"org.apache.activemq\" level=\"INFO\"></logger> -->\n<logger\nname=\n\"de.s0ftw4re.system.log\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"de.s0ftw4re.dapservice\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"org.jboss\"\nlevel=\n\"INFO\"\n></logger>\n<logger\nname=\n\"org.springframework\"\nlevel=\n\"INFO\"\n></logger>\n<root\nlevel=\n\"WARN\"\n>\n<appender-ref\nref=\n\"RequestLogAppender\"\n></appender-ref>\n<appender-ref\nref=\n\"S0ftw4re-Ondemand-Appender\"\n></appender-ref>\n<appender-ref\nref=\n\"Stdout\"\n></appender-ref>\n</root>"
        },
        {
          "block_type": "paragraph",
          "content": "Für TEST und DEMO wird standardmäßig das Loglevel auf INFO, für PROD auf ERROR gestellt."
        },
        {
          "block_type": "paragraph",
          "content": "Zu Beachten: die Einbindung der Zeile <logger name=\"de.s0ftw4re.dapservice\" level=\"INFO\"/> , die standardmäßig NICHT vorhanden ist, uns aber wichtige Informationen über die DAP-Komponente gibt."
        },
        {
          "block_type": "paragraph",
          "content": "Um\nden Loglevel zu ändern, muss, sofern in Z.2 (s.o.) der Scanner\neingeschaltet ist, die Anwendung nicht neugestartet werden. Es reicht,\nfolgende Schritte auszuführen:"
        },
        {
          "block_type": "list",
          "content": [
            "vim logback.xml",
            "Taste \"v\" für visuellen Modus, damit die zu bearbeitenden Zeilen auswählen",
            ":s/FIND/REPLACE/[Enter] (Bsp.: :s/INFO/ERROR/[Enter] )",
            "30 Sekunden warten, bevor Änderung in Kraft tritt"
          ]
        }
      ]
    }
  ],
  "source_file": "Logging.htm"
}