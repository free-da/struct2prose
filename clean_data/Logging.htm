<html><body><div class="col-xs-12" id="xwikicontent">
<div class="box floatinginfobox"><strong>Inhaltsverzeichnis</strong><ul><li><span class="wikilink"><a href="#HLogging-AnpassungenzurLaufzeitvornehmen">Logging-Anpassungen zur Laufzeit vornehmen</a></span></li><li><span class="wikilink"><a href="#Hserver.log">server.log</a></span></li><li><span class="wikilink"><a href="#HLogger-Einstellung">Logger-Einstellung</a></span></li></ul></div><p>Auf allen S0FTW4RE-Instanzen wird das Logging durch die Datei <span class="monospace">wildfly/standalone/configuration/logback.xml </span>konfiguriert.
 Die Logging-Konfigurationen sind auf allen Instanzen gleich, außer dass
 in TEST und DEMO ein Loglevel von "INFO" und auf PROD "ERROR" 
eingestellt ist. Um eine Versionierung dieser Datei zu gewährleisten, 
wird diese Datei durch einen Symlink auf das <span class="wikilink"><a href="https://wiki.domain.de/wiki/a4/view/01%20Neues%20IT%20Wiki/Anwendungen/Server%20Anwendungen/S0FTW4RE-Plattform/Know%20How/S0FTW4RE_REPO/">S0FTW4RE-REPO</a></span> bereitgestellt:</p><div class="box"><div class="code">ln -s /opt/s0ftw4reweb/S0FTW4RE_REPO/s0ftw4re_configfiles/<span style="color: #666666; ">[</span>PROD|DEMO|TEST<span style="color: #666666; ">]</span>/logback.xml /opt/s0ftw4reweb/wildfly/standalone/logback.xml</div></div><div><div class="box infomessage"><p>Jede
 Konfigurationsdatei soll AUSSCHLIEßLICH aus dem Repo verlinkt werden 
und auch nur dort bearbeitet und nach Bearbeitung wieder eingecheckt 
werden. Es sollen KEINE Dateien aus dem Repo kopiert werden!</p></div><p>Die <span class="monospace">logback.xml </span>wird von S0FTW4RE ausgeliefert und folgende ORGA-spezifische Anpassungen werden vorgenommen:</p><h1 class="wikigeneratedid" id="HLogging-AnpassungenzurLaufzeitvornehmen"><span>Logging-Anpassungen zur Laufzeit vornehmen</span></h1><div class="box"><div class="code"><span style="font-style: italic; color: #404040; ">&lt;!-- Zeile 2: regelmäßiges Scannen nach Veränderungen in der Datei --&gt;</span><br/><span style="font-weight: bold; color: #008000; ">&lt;configuration</span> <span style="color: #7D9029; ">scan=</span><span style="color: #BA2121; ">"true"</span> <span style="color: #7D9029; ">scanPeriod=</span><span style="color: #BA2121; ">"30 seconds"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/></div></div></div><p>Indem
 das Logging-Framework alle 30 Sekunden nach Veränderungen in der 
Logging-Konfiguration sucht, können Anpassungen im laufenden Betrieb 
ohne Neustart vorgenommen werden.</p><h1 class="wikigeneratedid" id="Hserver.log"><span>server.log</span><a class="edit_section" href="https://wiki.domain.de/wiki/a4/edit/01%20Neues%20IT%20Wiki/Anwendungen/Server%20Anwendungen/S0FTW4RE-Plattform/Know%20How/Logging-Konfiguration/WebHome?section=1" role="button" title="Bearbeiten"><span class="sr-only">Bearbeiten</span></a></h1><p>Das eigentliche Logging wird in der Datei <span class="monospace">/opt/s0ftw4reweb/wildfly/standalone/log/server.log</span>
 vorgenommen. Diese Datei soll täglich rotiert werden. Die Logs werden 
30 Tage aufbewahrt, und bis zu einem Gesamtvolumen von 30 GB.</p><div class="box"><div class="code"><span style="font-style: italic; color: #404040; ">&lt;!-- ab Z. 55 --&gt;</span><br/><span style="font-style: italic; color: #404040; ">&lt;!-- Definition des Appender für das Schreiben der Logdateien "server.log" --&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;appender</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"RequestLogAppender"</span> <span style="color: #7D9029; ">class=</span><span style="color: #BA2121; ">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;file&gt;</span>${JBOSS_HOME}/standalone/log/server.log<span style="font-weight: bold; color: #008000; ">&lt;/file&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;rollingPolicy</span> <span style="color: #7D9029; ">class=</span><span style="color: #BA2121; ">"ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/>            <span style="font-style: italic; color: #404040; ">&lt;!-- rollover daily --&gt;</span><br/>            <span style="font-weight: bold; color: #008000; ">&lt;fileNamePattern&gt;</span>/opt/s0ftw4reweb/wildfly/standalone/log/server.%d{yyyy-MM-dd}.%i.txt<span style="font-weight: bold; color: #008000; ">&lt;/fileNamePattern&gt;</span><br/>            <span style="font-style: italic; color: #404040; ">&lt;!-- each file should be at most 100MB, keep 30 days worth of history, but at most 3GB --&gt;</span><br/>            <span style="font-weight: bold; color: #008000; ">&lt;maxFileSize&gt;</span>100MB<span style="font-weight: bold; color: #008000; ">&lt;/maxFileSize&gt;</span><br/>            <span style="font-weight: bold; color: #008000; ">&lt;maxHistory&gt;</span>30<span style="font-weight: bold; color: #008000; ">&lt;/maxHistory&gt;</span><br/>            <span style="font-weight: bold; color: #008000; ">&lt;totalSizeCap&gt;</span>3GB<span style="font-weight: bold; color: #008000; ">&lt;/totalSizeCap&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;/rollingPolicy&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;encoder&gt;</span><br/>                <span style="font-weight: bold; color: #008000; ">&lt;pattern&gt;</span>%date - %logger:\n [%level]: %message%n%xException<span style="font-weight: bold; color: #008000; ">&lt;/pattern&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;/encoder&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;/appender&gt;</span><br/></div></div><div class="box warningmessage"><p>Zu
 Beachten, falls Konfigurationen kopiert werden: Der Name des Appenders 
"RequestLogAppender" muss zwingend erhalten werden, sonst weiß die 
Anwendung nicht, wo die zu loggenden Daten hingeschickt werden müssen.</p></div><p>Hier eine Erklärung der Einstellungen:</p><table style="margin-right:auto"><tbody><tr><th scope="col" style="width: 324px;">Element-Name</th><th scope="col" style="width: 1151px;">Erläuterung des Wert</th></tr><tr><td style="width:324px">file</td><td style="width:1151px">die zu konfigurierende Log-Datei</td></tr><tr><td style="width:324px">rollingPolicy</td><td style="width:1151px">durch welche Regel ist die Log-Rotation festgelegt? hier: <span class="monospace">SizeAndTimeBasedRollingPolicy</span>, also eine Rotation basierend auf verstreichender Zeit (täglich) und Größe (maxFileSize, hier: 100MB)</td></tr><tr><td style="width:324px">fileNamePattern</td><td style="width:1151px">der
 Ausgabeort der rotierten Log-Datei. Hier: am gleichen Ort wie das 
Original, mit dem Datums- und Nummerierungs-Suffix. Die Operatoren %d 
(date) und %i (Nummerierung) sind <em>zwingend</em> notwendig für die Verwendung der <span class="monospace">SizeAndTimeBasedRollingPolicy.</span> Hier wird ein Benennungsschema von bspw. <span class="monospace">server.2024-01-04.0.txt </span>erreicht.</td></tr><tr><td style="width:324px">maxFileSize</td><td style="width:1151px">die maximale Größe einer Datei, bevor sie rotiert wird</td></tr><tr><td style="width:324px">maxHistory</td><td style="width:1151px">die maximale Anzahl an aufbewahrten Logging-Dateien</td></tr><tr><td style="width:324px">totalSizeCap</td><td style="width:1151px">das Gesamtvolumen an aufbewahrten Logging-Dateien</td></tr><tr><td style="width:324px">pattern</td><td style="width:1151px">das Layout, in dem die Log-Nachrichten in die Logdatei geschrieben werden</td></tr></tbody></table><h1 class="wikigeneratedid" id="HLogger-Einstellung"><span>Logger-Einstellung</span><a class="edit_section" href="https://wiki.domain.de/wiki/a4/edit/01%20Neues%20IT%20Wiki/Anwendungen/Server%20Anwendungen/S0FTW4RE-Plattform/Know%20How/Logging-Konfiguration/WebHome?section=2" role="button" title="Bearbeiten"><span class="sr-only">Bearbeiten</span></a></h1><p>Im letzten Teil der logback.xml werden die verwendeten Logger eingebunden und deren Loglevel festgelegt:</p><div class="box"><div class="code"><span style="font-style: italic; color: #404040; ">&lt;!-- Z. 82 --&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"de.s0ftw4re.system.ui.component.demo"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"org.apache.cxf.services"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"de.s0ftw4re.system.ui"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"de.s0ftw4re.system.jpql"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"org.hibernate"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-style: italic; color: #404040; ">&lt;!-- &lt;logger name="org.hibernate.SQL" level="INFO" &gt;&lt;/logger&gt; --&gt;</span><br/>    <span style="font-style: italic; color: #404040; ">&lt;!-- &lt;logger name="org.jboss.as.ee" level="INFO"&gt;&lt;/logger&gt; --&gt;</span><br/>    <span style="font-style: italic; color: #404040; ">&lt;!-- &lt;logger name="org.hibernate" level="INFO"&gt;&lt;/logger&gt; --&gt;</span><br/>    <span style="font-style: italic; color: #404040; ">&lt;!-- &lt;logger name="org.jboss.jca" level="INFO"&gt;&lt;/logger&gt; --&gt;</span><br/>    <span style="font-style: italic; color: #404040; ">&lt;!-- &lt;logger name="com.arjuna" level="INFO"&gt;&lt;/logger&gt; --&gt;</span><br/>    <span style="font-style: italic; color: #404040; ">&lt;!-- &lt;logger name="de.s0ftw4re.system.jpql" level="INFO"&gt;&lt;/logger&gt; --&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"de.s0ftw4re.system.attach"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"de.s0ftw4re.system.service"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"org.springframework.orm"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-style: italic; color: #404040; ">&lt;!-- &lt;logger name="org.apache.activemq" level="INFO"&gt;&lt;/logger&gt; --&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"de.s0ftw4re.system.log"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"de.s0ftw4re.dapservice"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"org.jboss"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;logger</span> <span style="color: #7D9029; ">name=</span><span style="color: #BA2121; ">"org.springframework"</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"INFO"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/logger&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;root</span> <span style="color: #7D9029; ">level=</span><span style="color: #BA2121; ">"WARN"</span><span style="font-weight: bold; color: #008000; ">&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;appender-ref</span> <span style="color: #7D9029; ">ref=</span><span style="color: #BA2121; ">"RequestLogAppender"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/appender-ref&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;appender-ref</span> <span style="color: #7D9029; ">ref=</span><span style="color: #BA2121; ">"S0ftw4re-Ondemand-Appender"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/appender-ref&gt;</span><br/>        <span style="font-weight: bold; color: #008000; ">&lt;appender-ref</span> <span style="color: #7D9029; ">ref=</span><span style="color: #BA2121; ">"Stdout"</span><span style="font-weight: bold; color: #008000; ">&gt;&lt;/appender-ref&gt;</span><br/>    <span style="font-weight: bold; color: #008000; ">&lt;/root&gt;</span><br/><br/></div></div><p>Für TEST und DEMO wird standardmäßig das Loglevel auf INFO, für PROD auf ERROR gestellt.</p><div class="box warningmessage"><p>Zu Beachten: die Einbindung der Zeile <span class="monospace">&lt;logger name="de.s0ftw4re.dapservice" level="INFO"/&gt;</span>, die standardmäßig NICHT vorhanden ist, uns aber wichtige Informationen über die DAP-Komponente gibt.</p></div><p>Um
 den Loglevel zu ändern, muss, sofern in Z.2 (s.o.) der Scanner 
eingeschaltet ist, die Anwendung nicht neugestartet werden. Es reicht, 
folgende Schritte auszuführen:</p><ol><li>vim logback.xml</li><li>Taste "v" für visuellen Modus, damit die zu bearbeitenden Zeilen auswählen</li><li>:s/FIND/REPLACE/[Enter] (Bsp.: :s/INFO/ERROR/[Enter] )</li><li>30 Sekunden warten, bevor Änderung in Kraft tritt</li></ol>
</div></body></html>